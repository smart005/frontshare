/*!
 * slcore library v1.0.0
 * Date: 2013-08-16 
 * QQ:715837375
 * Copyright 2013 LiJingHuan
 */

function urlEscape(content) {
	return escape(content);
}

String.prototype.format = function(args) {
	///<summary>字符串格式化</summary>
	///<param name="args">参数,"{0},{1}".format("val1","val2");</param>
	var result = this;
	if(arguments.length > 0) {
		var reg;
		if(arguments.length == 1 && typeof(args) == "object") {
			for(var key in args) {
				if(args[key] != undefined) {
					reg = new RegExp("({" + key + "})", "g");
					result = result.replace(reg, args[key]);
				}
			}
		} else {
			for(var i = 0; i < arguments.length; i++) {
				if(arguments[i] != undefined) {
					reg = new RegExp("({[" + i + "]})", "g");
					result = result.replace(reg, arguments[i]);
				}
			}
		}
	}
	return result;
};

Date.prototype.formatDate = function(dateformat) {
	///<summary>日期格式化(毫秒级时间)</summary>
	///<param name="datestr">日期格式(yyyyMMddHHmmssS)</param>
	var o = {
		"M+": this.getMonth() + 1,
		"d+": this.getDate(),
		"H+": this.getHours(),
		"m+": this.getMinutes(),
		"s+": this.getSeconds(),
		"q+": Math.floor((this.getMonth() + 3) / 3),
		"S+": this.getMilliseconds()
	};
	if(/(y+)/.test(dateformat)) {
		dateformat = dateformat.replace(RegExp.$1, (this.getFullYear() + "").substr(4 -
			RegExp.$1.length));
	}
	for(var k in o) {
		if(new RegExp("(" + k + ")").test(dateformat)) {
			dateformat = dateformat.replace(RegExp.$1, RegExp.$1.length == 1 ?
				o[k] :
				("00" + o[k]).substr(("" + o[k]).length));
		}
	}
	return dateformat;
};

String.prototype.formatDate = function(dateformat) {
	///<summary>日期格式化</summary>
	///<param name="dateformat">日期格式(yyyyMMddHHmmssS)</param>
	return new Date(parseInt(this.filterString(/[\d]+/))).formatDate(dateformat);
}

String.prototype.byteLength = function() {
	///<summary>统计字符串的长度(汉字按2个字节计算)</summary>
	///<returns type="number">内容长度,汉字按2个字节计算</returns>
	var sStr, iCount, i, strTemp;
	iCount = 0;
	sStr = this.split("");
	for(i = 0; i < sStr.length; i++) {
		strTemp = escape(sStr[i]);
		if(strTemp.indexOf("%u", 0) == -1) {
			iCount = iCount + 1;
		} else {
			iCount = iCount + 2;
		}
	}
	return iCount;
};

String.prototype.validate = function(regularStr) {
	///<summary>
	///数据正则验证
	///</summary>
	///<param name="regularStr" type="object">对字符串this进行验证的正则表达式(引用$.validateRegular对应项)</param>
	return regularStr.test(this);
};

String.prototype.filterString = function(regularStr) {
	///<summary>
	///数据过滤
	///</summary>
	///<param name="regularStr" type="object">对字符串this进行过滤的正则表达式(引用$.filterRegular对应项)</param>
	var str = this.toString();
	return str.match(regularStr);
};

String.prototype.equals = function(strarg) {
	///<summary>比较两字符串是否相等(忽略大小写)</summary>
	///<param name="strarg">被比较字符串</param>
	///<returns type="Boolean">true:相等;false:不相等;</returns>
	var str1 = $.trim(this + "");
	var str2 = $.trim(strarg + "");
	return str1 == str2;
};

String.prototype.equalsIgnoreCase = function(strarg) {
	///<summary>比较两字符串是否相等(忽略大小写)</summary>
	///<param name="strarg">被比较字符串</param>
	///<returns type="Boolean">true:相等;false:不相等;</returns>
	var str1 = $.trim(this + "").toLowerCase();
	var str2 = $.trim(strarg + "").toLowerCase();
	return str1 == str2;
};

String.prototype.isContainerThisString = function(thisStr) {
	///<summary>字符串是否包含子字符串</summary>
	///<param name="thisStr">子字符串</param>
	///<returns type="Boolean">
	///true:包含;
	///false:不包含;
	///</returns>
	if($.isNullOrEmpty(this) || $.isNullOrEmpty(thisStr)) {
		return false;
	} else {
		return this.indexOf(thisStr) > 0 ? true : false;
	}
};

String.prototype.isContainerThisCharByInitials = function(thisStr) {
	///<summary>字符串从索引0开始是否包含指定字符</summary>
	///<param name="thisStr">子字符串</param>
	///<returns type="Boolean">
	///true:包含;
	///false:不包含;
	///</returns>
	if($.isNullOrEmpty(this) || $.isNullOrEmpty(thisStr)) {
		return false;
	} else {
		var chillen = thisStr.length;
		if(chillen > this.length) {
			return false;
		} else {
			var childstr = this.substr(0, chillen);
			if(childstr.equalsIgnoreCase(thisStr)) {
				return true;
			} else {
				return false;
			}
		}
	}
};

String.prototype.isContainerThisCharByEnd = function(thisStr) {
	///<summary>字符串结尾是否包含指定字符</summary>
	///<param name="thisStr">子字符串</param>
	///<returns type="Boolean">
	///true:包含;
	///false:不包含;
	///</returns>
	if($.isNullOrEmpty(this) || $.isNullOrEmpty(thisStr)) {
		return false;
	} else {
		var chillen = thisStr.length;
		if(chillen > this.length) {
			return false;
		} else {
			var startIdx = this.length - chillen;
			var childstr = this.substr(startIdx);
			if(childstr.equalsIgnoreCase(thisStr)) {
				return true;
			} else {
				return false;
			}
		}
	}
};

String.prototype.reverseString = function() {
	///<summary>字符串反转</summary>
	///<returns type="string">被反转后的字符串</returns>
	var sb = [];
	var str = this;
	var len = str.length;
	for(var i = len - 1; i >= 0; i--) {
		sb.push(str[i]);
	}
	return sb.join('');
};

(function($) {

	$.referFiles = [];

	$.isNullOrEmpty = function(str) {
		///<summary>
		/// 字符串空值判断
		/// true:空;false:非空;
		///</summary>
		///<param name="str">字符串</param>
		///<returns type="Boolean">
		/// true:空;false:非空;
		///</returns>
		if(str && $.trim(str).length > 0)
			return false;
		else
			return true;
	};

	$.checkUrl = function(url) {
		var urlReg = "/((http|ftp|https|file):\/\/([\w\-]+\.)+[\w\-]+(\/[\w\u4e00-\u9fa5\-\.\/?\@\%\!\&=\+\~\:\#\;\,]*)?)/ig";
		var re = new RegExp(strReg);
		if(!re.test(url)) {
			return false;
		} else {
			return true;
		}
	};

	$.validateRegular = {
		//仅数字
		OnlyNumber: /^[\d]+$/,
		//仅中文
		OnlyChinese: /^[\u4e00-\ufa29]+$/,
		//非中文
		NotChinese: /^[^\u4E00-\u9FA5\uF900-\uFA2D\uFF00-\uFFEF]+$/,
		//电话号码验证(如: +861383838438 1383838438 0576xxxxxxxx 0576-xxxxxxxx 0576-xxxxxxxx-010 400-800-8888 10086)
		Tel: /(^([+]{1}[\d]{2})?[1]\d{10}$)|(^[1]\d{10}$)|(^\d{7,8}$)|(^((\d{3}|\d{4}))?-?\d{7,8}$)|(^((\d{3}|\d{4}))?-?\d{7,8}(-(\d{2}|\d{3}|\d{4}))?$)|(^\d{3}-\d{3}-\d{4}$)|(^\d{5}$)|(^\d{3}-\d{3}-\d{8}$)/,
		//手机号码验证(如:+861383838438 1383838438)
		Mobile: /(^([+]{1}[\d]{2})?[1]\d{10}$)|(^[1]\d{10}$)/,
		//Email地址验证
		Email: /^[\w\-\.]+@[\w\-\.]+(\.\w+)+$/,
		//邮政编码验证
		PostCode: /^[0-9]{6}$/,
		//传真验证
		Fax: /^[+]{0,1}(\d){1,3}[ ]?([-]?((\d)|[ ]){1,12})+$/,
		//QQ号格式验证
		QQ: /^[1-9][0-9]{4,9}$/,
		//IP地址验证
		IP: /^(\d{1,3}.){3}(\d{1,3})$/,
		//图片验证
		Img: new RegExp("\.(?:jpg|jpeg|gif|png|ai|pdg|bmp|ico|tif|pcx|dxf|cdr)$$", "i"),
		//Url验证
		Url: /^[^:.\/?%&=“”,@!~\-\+\(\)\*\$\#`\u0022\u0027]([http:\/\/]{6})?((([w]{3}\.)?([\w-]+[\.][\w-]+)+)|([\d]{1,3}[\.]{1}[\d]{1,3}[\.]{1}[\d]{1,3}[\.]{1}[\d]{1,3})|([\w]+))([:][\d]+)?(\/[\w- ;.\/?%&=_#\u4E00-\u9FA5]+)*(\.[\w-\u4E00-\u9FA5]+)*([?\w=%&\|\u4E00-\u9FA5]+)?$/,
		//包含http的url验证
		UrlProtocol: /^[^:.\/?%&=“”,@!~\-\+\(\)\*\$\#`\u0022\u0027][http:\/\/]{6}((([w]{3}\.)?([\w-]+[\.][\w-]+)+)|([\d]{1,3}[\.]{1}[\d]{1,3}[\.]{1}[\d]{1,3}[\.]{1}[\d]{1,3})|([\w]+))([:][\d]+)?(\/[\w- ;.\/?%&=_#\u4E00-\u9FA5]+)*(\.[\w-\u4E00-\u9FA5]+)*([?\w=%&\|\u4E00-\u9FA5]+)?$/,
		//Guid验证
		Guid: /^(\{{0,1}([0-9a-fA-F]){8}-([0-9a-fA-F]){4}-([0-9a-fA-F]){4}-([0-9a-fA-F]){4}-([0-9a-fA-F]){12}\}{0,1})$/,
		//是否空Guid
		IsEmptyGuid: /^(\{{0,1}[0]{8}-([0]{4}-){3}[0]{12}\}{0,1})$/,
		//判断Json字符串
		IsJson: /^\{(.+:.+,*){1,}\}$/
	};

	$.SerialNumberGroupEnum = {
		//时间序列号
		TimeSerialNumber: 0,
		//时间-Guid序列号
		TimeGuidSerialNumber: 1,
		//时间-自定义序列号
		TimeCustomSerialNumber: 2,
		//时间-自定义-Guid序列号
		TimeCustomGuidSerialNumber: 3,
		//时间-Guid-自定义
		TimeGuidCustomSerialNumber: 4,
		//Guid序列号
		GuidSerialNumber: 5,
		//Guid-时间序列号
		GuidTimeSerialNumber: 6,
		//Guid-时间-自定义序列号
		GuidTimeCustomSerialNumber: 7,
		//Guid-自定义-时间序列号
		GuidCustomTimeSerialNumber: 8,
		//Guid-自定义序列号
		GuidCustomSerialNumber: 9,
		//自定义-时间序列号
		CustomTimeSerialNumber: 10,
		//自定义-Guid序列号
		CustomGuidSerialNumber: 11,
		//自定义-时间-Guid序列号
		CustomTimeGuidSerialNumber: 12,
		//自定义-Guid-时间序列号
		CustomGuidTimeSerialNumber: 13
	};

	$.TimeEnum = {
		//年
		YYYY: 'YYYY',
		//年 月
		YYYYMM: 'YYYYMM',
		//年 月 日
		YYYYMMdd: 'YYYYMMdd',
		//年 月 日 小时
		YYYYMMddHH: 'YYYYMMddHH',
		//年 月 日 小时 分
		YYYYMMddHHmm: 'YYYYMMddHHmm',
		//年 月 日 小时 分 秒
		YYYYMMddHHmmss: 'YYYYMMddHHmmss',
		//年 月 日 小时 分 秒 毫秒
		YYYYMMddHHmmssMS: 'YYYYMMddHHmmssMS'
	};

	var escape = /["\\\x00-\x1f\x7f-\x9f]/g,
		meta = {
			'\b': '\\b',
			'\t': '\\t',
			'\n': '\\n',
			'\f': '\\f',
			'\r': '\\r',
			'"': '\\"',
			'\\': '\\\\'
		},
		hasOwn = Object.prototype.hasOwnProperty;

	$.toJSON = typeof JSON === 'object' && JSON.stringify ? JSON.stringify : function(o) {
		///<summary>json对象转换成json字符串</summary>
		///<param name="o">json对象</param>
		///<returns type="string">json字符串</returns>
		if(o === null) {
			return 'null';
		}
		var pairs, k, name, val, type = $.type(o);
		if(type === 'undefined') {
			return undefined;
		}
		if(type === 'number' || type === 'boolean') {
			return String(o);
		}
		if(type === 'string') {
			return $.quoteString(o);
		}
		if(typeof o.toJSON === 'function') {
			return $.toJSON(o.toJSON());
		}
		if(type === 'date') {
			var month = o.getUTCMonth() + 1,
				day = o.getUTCDate(),
				year = o.getUTCFullYear(),
				hours = o.getUTCHours(),
				minutes = o.getUTCMinutes(),
				seconds = o.getUTCSeconds(),
				milli = o.getUTCMilliseconds();
			if(month < 10) {
				month = '0' + month;
			}
			if(day < 10) {
				day = '0' + day;
			}
			if(hours < 10) {
				hours = '0' + hours;
			}
			if(minutes < 10) {
				minutes = '0' + minutes;
			}
			if(seconds < 10) {
				seconds = '0' + seconds;
			}
			if(milli < 100) {
				milli = '0' + milli;
			}
			if(milli < 10) {
				milli = '0' + milli;
			}
			return '"' + year + '-' + month + '-' + day + 'T' +
				hours + ':' + minutes + ':' + seconds + '.' + milli + 'Z"';
		}
		pairs = [];
		if($.isArray(o)) {
			for(k = 0; k < o.length; k++) {
				pairs.push($.toJSON(o[k]) || 'null');
			}
			return '[' + pairs.join(',') + ']';
		}
		if(typeof o === 'object') {
			for(k in o) {
				if(hasOwn.call(o, k)) {
					type = typeof k;
					if(type === 'number') {
						name = '"' + k + '"';
					} else if(type === 'string') {
						name = $.quoteString(k);
					} else {
						continue;
					}
					type = typeof o[k];
					if(type !== 'function' && type !== 'undefined') {
						val = $.toJSON(o[k]);
						pairs.push(name + ':' + val);
					}
				}
			}
			return '{' + pairs.join(',') + '}';
		}
		return '';
	};
	$.evalJSON = typeof JSON === 'object' && JSON.parse ? JSON.parse : function(str) {
		///<summary>解析json对象</summary>
		///<param name="str">json字符串</param>
		///<returns type="object">json对象</returns>
		return eval('(' + str + ')');
	};
	$.secureEvalJSON = typeof JSON === 'object' && JSON.parse ? JSON.parse : function(str) {
		var filtered = str.replace(/\\["\\\/bfnrtu]/g, '@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, ']').replace(/(?:^|:|,)(?:\s*\[)+/g, '');
		if(/^[\],:{}\s]*$/.test(filtered)) {
			return eval('(' + str + ')');
		}
		throw new SyntaxError('Error parsing JSON, source is not valid.');
	};
	$.quoteString = function(str) {
		if(str.match(escape)) {
			return '"' + str.replace(escape, function(a) {
				var c = meta[a];
				if(typeof c === 'string') {
					return c;
				}
				c = a.charCodeAt();
				return '\\u00' + Math.floor(c / 16).toString(16) + (c % 16).toString(16);
			}) + '"';
		}
		return '"' + str + '"';
	};

	$.extend({
		protocol: {
			domain: function() {
				///<summary>返回url域名(主机地址最后带/)</summary>
				var path = "{0}//{1}".format(window.location.protocol, window.location.host);
				return path.isContainerThisCharByEnd("/") ? path : "{0}/".format(path);
			}
		},
		UrlParams: {
			get: function(paramkey) {
				///<summary>
				///获取Url参数值
				///</summary>
				///<param name="paraName" type="string">url参数名</param>
				var sUrl = window.location.href;
				var idx = sUrl.indexOf("?");
				if(idx >= 0) {
					var keyidx = sUrl.indexOf(paramkey);
					if(keyidx >= 0) {
						var sReg = "(?:\\?|&){1}" + paramkey + "=([^&]*)";
						var re = new RegExp(sReg, "gi");
						re.exec(sUrl);
						if(!$.isNullOrEmpty(RegExp.$1) && RegExp.$1 != "link" && RegExp.$1 != "type")
							return RegExp.$1;
						else
							return "";
					} else {
						return "";
					}
				} else {
					return "";
				}
			},
			adds: function(args) {
				///<summary>设置url参数集</summary>
				///<param name="args">参数集(如:{key1:arg1,key2:arg2,...}或[{...}])</param>
				///<returns type="string">已组装的url</returns>
				var sUrl = window.location.href;
				if($.isNullOrEmpty(args)) {
					return sUrl;
				}
				var obj;
				if(($.type(args)).equalsIgnoreCase("object")) {
					obj = args;
				} else {
					obj = eval('({0})'.format(args));
				}
				var idx = sUrl.lastIndexOf("?");
				var baseurl = idx > 0 ? sUrl.substr(0, idx) : sUrl;
				var oldparamstr = idx > 0 ? sUrl.substr(idx + 1) : "";
				var oldparames = oldparamstr.split('&');
				var paramassemble = [];
				if(($.type(obj)).equalsIgnoreCase("array")) {
					for(var i = 0; i < obj.length; i++) {
						for(var itemkey in obj[i]) {
							paramassemble.push("{0}={1}&".format(itemkey, obj[i]['{0}'.format(itemkey)]));
						}
					}
				} else {
					for(var key in obj) {
						paramassemble.push("{0}={1}&".format(key, obj['{0}'.format(key)]));
					}
				}
				var result = paramassemble.join('');
				for(var i in oldparames) {
					var item = oldparames[i];
					var itemsplit = item.split("=");
					if(result.indexOf(itemsplit[0]) < 0) {
						paramassemble.push("{0}&".format(item));
					}
				}
				result = paramassemble.join('');
				result = result.substr(0, result.length - 1);
				return baseurl + "?" + result;
			},
			add: function(keyname, value) {
				///<summary>设置url参数</summary>
				///<param name="key">参数键</param>
				///<param name="value">参数值</param>
				///<returns type="string">已组装的url</returns>
				return this.adds('{{0}:"{1}"}'.format(keyname, value));
			},
			remove: function(key) {
				///<summary>移除url参数</summary>
				///<param name="key" type="string">需要移除参数的键</param>
				///<returns type="string">url</returns>
				var sUrl = window.location.href;
				if($.isNullOrEmpty(key) || !sUrl.isContainerThisString("?")) {
					return sUrl;
				}
				var idx = sUrl.lastIndexOf("?");
				var baseurl = sUrl.substr(0, idx);
				var paramstr = sUrl.substr(idx + 1);
				var newparamstr = [];
				var params = paramstr.split("&");
				for(var i in params) {
					var item = params[i];
					var itemsplit = item.split("=");
					if(!itemsplit[0].equalsIgnoreCase(key)) {
						newparamstr.push("{0}&".format(item));
					}
				}
				if(newparamstr.length > 0) {
					var newurlparams = newparamstr.join('');
					newurlparams = newurlparams.substr(0, newurlparams.length - 1);
					return baseurl + "?" + newurlparams;
				} else {
					return baseurl;
				}
			},
			set: function(key, value) {
				///<summary>设置url参数</summary>
				///<param name="key">需要设置的参数键</param>
				///<param name="value">需要设置的参数值</param>
				///<returns type="string">url</returns>
				var sUrl = window.location.href;
				if($.isNullOrEmpty(key) || !sUrl.isContainerThisString("?")) {
					return sUrl;
				}
				var idx = sUrl.lastIndexOf("?");
				var baseurl = sUrl.substr(0, idx);
				var paramstr = sUrl.substr(idx + 1);
				var newparamstr = [];
				var params = paramstr.split("&");
				for(var i in params) {
					var item = params[i];
					var itemsplit = item.split("=");
					if(itemsplit[0].equalsIgnoreCase(key)) {
						newparamstr.push("{0}={1}&".format(key, value));
					} else {
						newparamstr.push("{0}&".format(item));
					}
				}
				if(newparamstr.length > 0) {
					var newurlparams = newparamstr.join('');
					newurlparams = newurlparams.substr(0, newurlparams.length - 1);
					return baseurl + "?" + newurlparams;
				} else {
					return baseurl;
				}
			}
		},
		getScriptUrl: function(scriptname) {
			///<summary>取脚本引用地址</summary>
			///<param name="scriptname">脚本文件名(包含.js)</param>
			///<returns type="string">脚本文件url地址</returns>
			var sc = document.getElementsByTagName('script'),
				bp = '',
				i = 0,
				l = sc.length;
			if(!scriptname.isContainerThisCharByEnd(".js")) {
				scriptname += ".js";
			}
			for(; i < l; i++) {
				if(sc[i].src.isContainerThisString(scriptname)) {
					bp = !!document.querySelector ?
						sc[i].src : sc[i].getAttribute('src', 4);
					break;
				}
			}
			return bp.split('?')[0];
		},
		Request: {
			Url: function(requestpath) {
				///<summary>获取请求url</summary>
				///<param name="requestpath">相对于站点的路径(root/action/login.ashx)</param>
				requestpath += requestpath.indexOf("?") > 0 ? "&" : "?";
				return $.protocol.domain() + requestpath + "date=" + new Date().getTime();
			},
			makeJsonRequest: function(url, requestType, data, headers, successCall, completeCall) {
				$.ajax({
					url: url,
					type: requestType,
					async: true,
					contentType: "application/json",
					dataType: "json",
					timeout: 10000,
					headers: headers,
					data: data,
					success: function(result) {
						if(successCall != null && successCall != undefined) {
							successCall(result);
						}
					},
					complete: function() {
						if(completeCall != null && completeCall != undefined) {
							completeCall();
						}
					}
				});
			},
			getRequest: function(url, data, successCall, completeCall) {
				var token = $.cookie('token');
				if(token == undefined || token == null) {
					token = "1";
				}
				var client = "h5";
				this.makeJsonRequest(url, "GET", data, {
					"token": token,
					"client": client
				}, successCall, completeCall);
			},
			postRequest: function(url, data, successCall, completeCall) {
				var token = $.cookie('token');
				if(token == undefined || token == null) {
					token = "1";
				}
				var client = "h5";
				this.makeJsonRequest(url, "POST", data, {
					"token": token,
					"client": client
				}, successCall, completeCall);
			},
			putRequest: function(url, data, successCall, completeCall) {
				var token = $.cookie('token');
				if(token == undefined || token == null) {
					token = "1";
				}
				var client = "h5";
				this.makeJsonRequest(url, "POST", $.extend({}, data, {
					_method: 'put'
				}), {
					"token": token,
					"client": client
				}, successCall, completeCall);
			},
			deleteRequest: function(url, data, successCall, completeCall) {
				var token = $.cookie('token');
				if(token == undefined || token == null) {
					token = "1";
				}
				var client = "h5";
				this.makeJsonRequest(url, "POST", $.extend({}, data, {
					_method: 'delete'
				}), {
					"token": token,
					"client": client
				}, successCall, completeCall);
			},
			patchRequest: function(url, data, successCall, completeCall) {
				var token = $.cookie('token');
				if(token == undefined || token == null) {
					token = "1";
				}
				var client = "h5";
				this.makeJsonRequest(url, "POST", $.extend({}, data, {
					_method: 'patch'
				}), {
					"token": token,
					"client": client
				}, successCall, completeCall);
			}
		},
		GUID: function() {
			///<summary>唯一标识符</summary>
			///<returns type="string">guid</returns>

			function G() {
				return(((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);
			}

			var guid = (G() + G() + "-" + G() + "-" + G() + "-" +
				G() + "-" + G() + G() + G()).toLowerCase();
			return guid;
		},
		GetRandomNum: function(min, max) {
			///<summary>生成随机数</summary>
			///<param name="min">最小值</param>
			///<param name="max">最大值</param>
			///<returns type="number">随机数</returns>
			var Range = max - min;
			var Rand = Math.random();
			return(min + Math.round(Rand * Range));
		},
		StrLimit: function(sourcestr, len) {
			var sStr, iCount, i, strTemp, substr = "";
			iCount = 0;
			sStr = sourcestr.split("");
			for(i = 0; i < sStr.length; i++) {
				strTemp = urlEscape(sStr[i]);
				if(strTemp.indexOf("%u", 0) == -1) {
					iCount = iCount + 1;
				} else {
					iCount = iCount + 2;
				}
				if(len * 2 > iCount) {
					substr += sStr[i];
				} else {
					substr += "...";
					break;
				}
			}
			return substr;
		}
	});
})($);